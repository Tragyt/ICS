services:

#PLC
  plc1:
    pull_policy: never
    container_name: plc1
    build:
      context: ./plc
      dockerfile: Dockerfile
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "test", "-f", "/tmp/.plc_ready"]
      interval: 2s
      timeout: 1s
      retries: 30
      start_period: 5s
    networks:
      ics:
        ipv4_address: 192.168.1.1
    ports:
      - 8081:8080

  plc2:
    pull_policy: never
    container_name: plc2
    build:
      context: ./plc
      dockerfile: Dockerfile
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "test", "-f", "/tmp/.plc_ready"]
      interval: 2s
      timeout: 1s
      retries: 30
      start_period: 5s
    networks:
      ics:
        ipv4_address: 192.168.2.1
    ports:
      - 8082:8080

  plc3:
    pull_policy: never
    container_name: plc3
    build:
      context: ./plc
      dockerfile: Dockerfile
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "test", "-f", "/tmp/.plc_ready"]
      interval: 2s
      timeout: 1s
      retries: 30
      start_period: 5s
    networks:
      ics:
        ipv4_address: 192.168.3.1
    ports:
      - 8083:8080

  plc4:
    pull_policy: never
    container_name: plc4
    build:
      context: ./plc
      dockerfile: Dockerfile
    env_file:
      - .env
    healthcheck:
      test: ["CMD", "test", "-f", "/tmp/.plc_ready"]
      interval: 2s
      timeout: 1s
      retries: 30
      start_period: 5s
    networks:
      ics:
        ipv4_address: 192.168.4.1
    ports:
      - 8084:8080
      
# HIL
  hil1:
    pull_policy: never
    container_name: hil1
    build:
      context: ./hil
      dockerfile: Dockerfile
    environment:
      - plc=1
    networks:
      ics:
        ipv4_address: 192.168.1.2
    depends_on:
      plc1:
        condition: service_healthy

  hil2:
    pull_policy: never
    container_name: hil2
    build:
      context: ./hil
      dockerfile: Dockerfile
    environment:
      - plc=2
    networks:
      ics:
        ipv4_address: 192.168.2.2
    depends_on:
      plc2:
        condition: service_healthy

  hil3:
    pull_policy: never
    container_name: hil3
    build:
      context: ./hil
      dockerfile: Dockerfile
    environment:
      - plc=3
    networks:
      ics:
        ipv4_address: 192.168.3.2
    depends_on:
      plc3:
        condition: service_healthy

  hil4:
    pull_policy: never
    container_name: hil4
    build:
      context: ./hil
      dockerfile: Dockerfile
    environment:
      - plc=4
    networks:
      ics:
        ipv4_address: 192.168.4.2
    depends_on:
      plc4:
        condition: service_healthy

# SCADA
  scada:
    pull_policy: never
    container_name: scada
    build:
      context: ./scada
      dockerfile: Dockerfile
    volumes:
      - scada:/opt/ScadaBR/tomcat/webapps/ScadaBR/db
    depends_on:
      plc1:
        condition: service_healthy
      plc2:
        condition: service_healthy
      plc3:
        condition: service_healthy
      plc4:
        condition: service_healthy
    networks:
      - ics
    ports:
      - 8080:8080

volumes:
  scada:

networks:
  ics:
    driver: bridge
    ipam:
      config:
        - subnet: 192.168.0.0/16




